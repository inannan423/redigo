import { Callout } from 'nextra/components'

# Redis å¹¶å‘å®‰å…¨å®ç°

åœ¨å‰é¢çš„ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬å®ç°äº† Redis çš„å„ç§æ•°æ®ç»“æ„ï¼šå­—ç¬¦ä¸²ã€å“ˆå¸Œè¡¨ã€é“¾è¡¨ã€é›†åˆå’Œæœ‰åºé›†åˆã€‚è¿™äº›æ•°æ®ç»“æ„åœ¨å•çº¿ç¨‹ç¯å¢ƒä¸‹å·¥ä½œå¾—å¾ˆå¥½ï¼Œä½†æ˜¯å½“å¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶è®¿é—®åŒä¸€ä¸ªæ•°æ®æ—¶ï¼Œå°±å¯èƒ½å‡ºç°å¹¶å‘å®‰å…¨é—®é¢˜ã€‚

åœ¨è¿™ä¸€ç« ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•è¯†åˆ«å¹¶å‘å®‰å…¨é—®é¢˜ï¼Œè®¾è®¡è§£å†³æ–¹æ¡ˆï¼Œå¹¶å®ç°ä¸€ä¸ªé«˜æ€§èƒ½çš„å¹¶å‘å®‰å…¨æœºåˆ¶ã€‚

## å¹¶å‘é—®é¢˜çš„å‘ç°

### é—®é¢˜èƒŒæ™¯

è™½ç„¶ Redis æœ¬èº«æ˜¯å•çº¿ç¨‹çš„äº‹ä»¶å¾ªç¯æ¨¡å‹ï¼Œä½†åœ¨æˆ‘ä»¬çš„å®ç°ä¸­ï¼Œæ¯ä¸ªå®¢æˆ·ç«¯è¿æ¥éƒ½æ˜¯ç”±å•ç‹¬çš„ goroutine å¤„ç†çš„ã€‚è¿™æ„å‘³ç€**å¤šä¸ª goroutine å¯èƒ½åŒæ—¶è®¿é—®å’Œä¿®æ”¹åŒä¸€ä¸ªæ•°æ®ç»“æ„**ï¼Œä»è€Œå¯¼è‡´æ•°æ®ç«äº‰å’Œä¸ä¸€è‡´æ€§ã€‚

### ä½¿ç”¨ redis-benchmark å‘ç°é—®é¢˜

å½“æˆ‘ä»¬ä½¿ç”¨ `redis-benchmark` è¿›è¡Œå‹åŠ›æµ‹è¯•æ—¶ï¼Œå‘ç°äº†ä¸¥é‡çš„å¹¶å‘å®‰å…¨é—®é¢˜ï¼š

```bash
$ redis-benchmark -h localhost -p 6380 -n 50000 -c 25 -t sadd,spop
```

æµ‹è¯•ç»“æœï¼š

```
fatal error: concurrent map read and map write

goroutine 45 [running]:
runtime.throw(0x1234567, 0x1a)
    /usr/local/go/src/runtime/panic.go:1116 +0x72 fp=0xc000123abc sp=0xc000123a90 pc=0x1234567
runtime.mapaccess1_faststr(0x1234567, 0xc000234def, 0xc000345abc, 0x6)
    /usr/local/go/src/runtime/map_faststr.go:21 +0x1ea fp=0xc000123def sp=0xc000123abc pc=0x1234567
```

è¿™ä¸ªé”™è¯¯æç¤ºæˆ‘ä»¬ï¼š**å¤šä¸ª goroutine æ­£åœ¨åŒæ—¶è¯»å†™åŒä¸€ä¸ª map**ï¼Œè¿™åœ¨ Go ä¸­æ˜¯è‡´å‘½çš„é”™è¯¯ã€‚

### é—®é¢˜åŸå› åˆ†æ

è®©æˆ‘ä»¬åˆ†æä¸€ä¸ªå…·ä½“çš„ä¾‹å­ï¼š`SPOP` å‘½ä»¤çš„å®ç°

```go filename="database/set.go" {15-20}
// æœ‰é—®é¢˜çš„å®ç°
func execSPop(db *DB, args [][]byte) resp.Reply {
    key := string(args[0])
    
    // æ­¥éª¤1ï¼šè·å–é›†åˆå¯¹è±¡
    setObj, errReply := getAsSet(db, key)
    if errReply != nil || setObj == nil {
        return reply.MakeNullBulkReply()
    }
    
    // æ­¥éª¤2ï¼šè·å–éšæœºæˆå‘˜ - è¿™é‡Œä¼šéå†å†…éƒ¨ map
    members := setObj.RandomDistinctMembers(count)
    
    // æ­¥éª¤3ï¼šç§»é™¤æˆå‘˜ - è¿™é‡Œä¼šä¿®æ”¹å†…éƒ¨ map
    for _, member := range members {
        setObj.Remove(member) 
    }
    
    return result
}
```

**é—®é¢˜åˆ†æ**ï¼š

1. **æ­¥éª¤1**ï¼šå¤šä¸ª goroutine å¯èƒ½è·å–åˆ°**åŒä¸€ä¸ª `setObj` å®ä¾‹**
2. **æ­¥éª¤2**ï¼š`RandomDistinctMembers()` æ–¹æ³•ä¼šéå†å†…éƒ¨çš„ `map[string]struct{}`
3. **æ­¥éª¤3**ï¼š`Remove()` æ–¹æ³•ä¼šä¿®æ”¹å†…éƒ¨çš„ `map[string]struct{}`

å½“ goroutine A åœ¨æ­¥éª¤2éå† map æ—¶ï¼Œgoroutine B åŒæ—¶åœ¨æ­¥éª¤3ä¿®æ”¹ mapï¼Œå°±ä¼šè§¦å‘ Go è¿è¡Œæ—¶çš„ç«æ€æ£€æµ‹ï¼Œå¯¼è‡´ç¨‹åºå´©æºƒã€‚

<Callout type="error">
**å…³é”®ç†è§£**ï¼šè™½ç„¶æ•°æ®åº“å±‚é¢çš„ `SyncDict` ä¿æŠ¤äº†å¯¹ä¸åŒ key çš„å¹¶å‘è®¿é—®ï¼Œä½†å®ƒ**æ— æ³•ä¿æŠ¤å¯¹åŒä¸€ä¸ª value å¯¹è±¡å†…éƒ¨çš„å¹¶å‘ä¿®æ”¹**ã€‚

å…·ä½“æ¥è¯´ï¼š
1. `SyncDict` ç¡®ä¿äº†å¯¹åŒä¸€ key çš„ `Load` å’Œ `Store` æ“ä½œæ˜¯åŸå­çš„
2. ä½†å¤šä¸ª goroutine è·å–åˆ°åŒä¸€ä¸ªæ•°æ®ç»“æ„å®ä¾‹åï¼Œå¯¹è¯¥å®ä¾‹å†…éƒ¨çš„å¹¶å‘æ“ä½œä»ç„¶æ˜¯ä¸å®‰å…¨çš„
3. è¿™å°±åƒå¤šä¸ªäººåŒæ—¶æ‹¿åˆ°äº†åŒä¸€æŠŠé’¥åŒ™ï¼Œç„¶ååŒæ—¶è¯•å›¾ä¿®æ”¹é”åé¢çš„å†…å®¹
</Callout>

## å¹¶å‘å®‰å…¨è§£å†³æ–¹æ¡ˆè®¾è®¡

### æ–¹æ¡ˆé€‰æ‹©

æˆ‘ä»¬æœ‰å‡ ç§è§£å†³å¹¶å‘é—®é¢˜çš„æ–¹æ¡ˆï¼š

1. **æ•°æ®ç»“æ„çº§åˆ«çš„é”**ï¼šåœ¨æ¯ä¸ªæ•°æ®ç»“æ„å†…éƒ¨æ·»åŠ äº’æ–¥é”
2. **æ•°æ®åº“çº§åˆ«çš„ key é”**ï¼šä¸ºæ¯ä¸ª key æä¾›ç»†ç²’åº¦çš„é”å®š  
3. **å…¨å±€é”**ï¼šä½¿ç”¨ä¸€ä¸ªå…¨å±€é”ä¿æŠ¤æ‰€æœ‰æ“ä½œ

ç»è¿‡æƒè¡¡ï¼Œæˆ‘ä»¬é€‰æ‹©**æ•°æ®åº“çº§åˆ«çš„ key é”**ï¼ŒåŸå› å¦‚ä¸‹ï¼š

| æ–¹æ¡ˆ | ä¼˜ç‚¹ | ç¼ºç‚¹ | è¯„ä»· |
|------|------|------|------|
| **Key çº§åˆ«é”** | ç»†ç²’åº¦é”å®šï¼Œä¸åŒ key ä¸é˜»å¡ï¼Œæ€§èƒ½ä¼˜è¶Š | éœ€è¦é¢å¤–å†…å­˜å­˜å‚¨é” | âœ… **æ¨è** |
| å…¨å±€é” | å®ç°ç®€å• | æ‰€æœ‰æ“ä½œä¸²è¡ŒåŒ–ï¼Œæ€§èƒ½å·® | âŒ ä¸æ¨è |
| æ•°æ®ç»“æ„é” | æ€§èƒ½è¾ƒå¥½ | éœ€è¦ä¿®æ”¹æ‰€æœ‰æ•°æ®ç»“æ„ï¼Œå¤æ‚ | âŒ ä¸æ¨è |

### æ ¸å¿ƒè®¾è®¡æ€æƒ³

æˆ‘ä»¬çš„è§£å†³æ–¹æ¡ˆåŸºäºä»¥ä¸‹æ ¸å¿ƒæ€æƒ³ï¼š

1. **Key çº§åˆ«çš„ç»†ç²’åº¦é”å®š**ï¼šæ¯ä¸ª key éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„è¯»å†™é”
2. **è‡ªåŠ¨é”ç®¡ç†**ï¼šä½¿ç”¨ `sync.Map` æ¥åŠ¨æ€åˆ›å»ºå’Œç®¡ç†é”
3. **ä¾¿æ·çš„é”å®šæ¥å£**ï¼šæä¾›ç®€å•æ˜“ç”¨çš„é”å®šæ–¹æ³•
4. **è¯»å†™é”åˆ†ç¦»**ï¼šæ”¯æŒå¹¶å‘è¯»æ“ä½œï¼Œåªå¯¹å†™æ“ä½œè¿›è¡Œäº’æ–¥

## Key çº§åˆ«é”ç®¡ç†å™¨å®ç°

### KeyLockManager ç»“æ„

é¦–å…ˆï¼Œæˆ‘ä»¬åœ¨ `database/db.go` ä¸­å®šä¹‰é”ç®¡ç†å™¨ï¼š

```go filename="database/db.go"
// KeyLockManager manages locks for individual keys
type KeyLockManager struct {
    locks sync.Map   // map[string]*sync.RWMutex
}

// NewKeyLockManager creates a new KeyLockManager instance
func NewKeyLockManager() *KeyLockManager {
    return &KeyLockManager{}
}
```

**è®¾è®¡è¯´æ˜**ï¼š
- `locks sync.Map`ï¼šä½¿ç”¨å¹¶å‘å®‰å…¨çš„ map æ¥å­˜å‚¨æ¯ä¸ª key å¯¹åº”çš„é”

### é”æ“ä½œæ–¹æ³•

```go filename="database/db.go"
// Lock acquires a write lock for the given key
func (klm *KeyLockManager) Lock(key string) {
    lockInterface, _ := klm.locks.LoadOrStore(key, &sync.RWMutex{})
    lock := lockInterface.(*sync.RWMutex)
    lock.Lock()
}

// Unlock releases a write lock for the given key
func (klm *KeyLockManager) Unlock(key string) {
    if lockInterface, ok := klm.locks.Load(key); ok {
        lock := lockInterface.(*sync.RWMutex)
        lock.Unlock()
    }
}

// RLock acquires a read lock for the given key
func (klm *KeyLockManager) RLock(key string) {
    lockInterface, _ := klm.locks.LoadOrStore(key, &sync.RWMutex{})
    lock := lockInterface.(*sync.RWMutex)
    lock.RLock()
}

// RUnlock releases a read lock for the given key
func (klm *KeyLockManager) RUnlock(key string) {
    if lockInterface, ok := klm.locks.Load(key); ok {
        lock := lockInterface.(*sync.RWMutex)
        lock.RUnlock()
    }
}
```

**å…³é”®å®ç°ç»†èŠ‚**ï¼š

1. **`LoadOrStore` çš„ä½¿ç”¨**ï¼šè¿™æ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼Œå¦‚æœ key ä¸å­˜åœ¨å°±åˆ›å»ºæ–°é”ï¼Œå¦‚æœå­˜åœ¨å°±è¿”å›ç°æœ‰é”
2. **ç±»å‹æ–­è¨€**ï¼šå°† `interface{}` è½¬æ¢ä¸º `*sync.RWMutex`
3. **è¯»å†™é”åˆ†ç¦»**ï¼šæ”¯æŒå¤šä¸ªå¹¶å‘è¯»æ“ä½œï¼Œä½†å†™æ“ä½œæ˜¯äº’æ–¥çš„

### æ›´æ–° DB ç»“æ„

åœ¨ `DB` ç»“æ„ä½“ä¸­æ·»åŠ é”ç®¡ç†å™¨ï¼š

```go filename="database/db.go" {7}
type DB struct {
    index   int
    data    dict.Dict
    addAof  func(CmdLine)
    lockMgr *KeyLockManager  // æ–°å¢ï¼šé”ç®¡ç†å™¨
}

// MakeDB creates a new DB instance
func MakeDB() *DB {
    return &DB{
        index: 0,
        data:  dict.MakeSyncDict(),
        addAof: func(line CmdLine) {
            // No-op by default
        },
        lockMgr: NewKeyLockManager(), // åˆå§‹åŒ–é”ç®¡ç†å™¨
    }
}
```

### é”çš„åˆ é™¤

ä¸ºäº†é˜²æ­¢å†…å­˜æ³„æ¼ï¼Œæˆ‘ä»¬éœ€è¦åœ¨åˆé€‚çš„æ—¶æœºåˆ é™¤ä¸å†ä½¿ç”¨çš„é”ã€‚å…·ä½“æ¥è¯´ï¼Œå½“ä¸€ä¸ª key è¢«æ°¸ä¹…åˆ é™¤æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥è°ƒç”¨ `CleanupLock` æ–¹æ³•æ¥æ¸…ç†å¯¹åº”çš„é”ã€‚

```go filename="database/db.go"
// CleanupLock removes the lock for the given key
func (klm *KeyLockManager) CleanupLock(key string) {
    klm.locks.Delete(key)
}
```

ç„¶ååœ¨ `DB` çš„ `Remove` æ–¹æ³•ä¸­è°ƒç”¨ï¼š

```go filename="database/db.go" {8-12}
// Remove deletes the DataEntity associated with the given key from the database
func (db *DB) Remove(key string) int {
	result := db.data.Remove(key)
	// Clean up the lock for the deleted key to prevent memory leaks
	if result > 0 {
		db.lockMgr.CleanupLock(key)
	}
	return result
}
```

åŒæ—¶åœ¨ `Removes` æ–¹æ³•ä¸­ä¹Ÿéœ€è¦ç¡®ä¿åœ¨åˆ é™¤æ•°æ®åæ¸…ç†é”ï¼š

```go filename="database/db.go"
// Removes deletes the DataEntity associated with the given keys from the database
func (db *DB) Removes(keys ...string) int {
	deleted := 0
	for _, key := range keys {
		_, ok := db.data.Get(key)
		if ok {
			db.data.Remove(key)
			// Clean up the lock for the deleted key to prevent memory leaks
			db.lockMgr.CleanupLock(key)
			deleted++
		}
	}
	return deleted
}
```

åœ¨ Flush æ—¶ä¹Ÿéœ€è¦æ¸…ç†æ‰€æœ‰é”ï¼š

```go filename="database/db.go"
// Flush clears the database by removing all DataEntity objects
func (db *DB) Flush() {
	db.data.Clear()
	// Clear all locks when flushing the database
	db.lockMgr.locks = sync.Map{}
}
```

èƒ½åœ¨é‡Šæ”¾é”çš„æ—¶å€™åˆ é™¤è¿™ä¸ªé”å—ï¼ï¼Ÿ

ç­”æ¡ˆæ˜¯ä¸è¡Œã€‚å› ä¸ºåœ¨é‡Šæ”¾é”æ—¶ï¼Œå¯èƒ½æœ‰å…¶ä»– goroutine æ­£åœ¨ç­‰å¾…è¿™ä¸ªé”ã€‚å¦‚æœæˆ‘ä»¬åœ¨é‡Šæ”¾é”æ—¶åˆ é™¤å®ƒï¼Œå°±ä¼šå¯¼è‡´å…¶ä»– goroutine æ— æ³•è·å–åˆ°è¿™ä¸ªé”ï¼Œä»è€Œå¼•å‘æ­»é”æˆ–å…¶ä»–å¹¶å‘é—®é¢˜ã€‚

## ä¾¿æ·çš„é”å®šæ¥å£

ä¸ºäº†ä½¿é”çš„ä½¿ç”¨æ›´åŠ ä¾¿æ·å’Œå®‰å…¨ï¼Œæˆ‘ä»¬åœ¨ `DB` ç»“æ„ä½“ä¸­æ·»åŠ ä¸€äº›é«˜çº§çš„é”å®šæ–¹æ³•ï¼š

```go filename="database/db.go"
// WithKeyLock executes the given function with a write lock on the specified key
func (db *DB) WithKeyLock(key string, fn func()) {
    db.lockMgr.Lock(key)
    defer db.lockMgr.Unlock(key)
    fn()
}

// WithKeyRLock executes the given function with a read lock on the specified key
func (db *DB) WithKeyRLock(key string, fn func()) {
    db.lockMgr.RLock(key)
    defer db.lockMgr.RUnlock(key)
    fn()
}

// WithKeyLockReturn executes the given function with a write lock and returns the result
func (db *DB) WithKeyLockReturn(key string, fn func() interface{}) interface{} {
    db.lockMgr.Lock(key)
    defer db.lockMgr.Unlock(key)
    return fn()
}
```

**è®¾è®¡ä¼˜åŠ¿**ï¼š

1. **è‡ªåŠ¨ç®¡ç†**ï¼šä½¿ç”¨ `defer` ç¡®ä¿é”ä¸€å®šä¼šè¢«é‡Šæ”¾
2. **ç®€åŒ–ä½¿ç”¨**ï¼šè°ƒç”¨è€…åªéœ€è¦å…³æ³¨ä¸šåŠ¡é€»è¾‘ï¼Œä¸éœ€è¦æ‰‹åŠ¨ç®¡ç†é”
3. **ç±»å‹å®‰å…¨**ï¼šé¿å…å¿˜è®°é‡Šæ”¾é”æˆ–é‡Šæ”¾é”™è¯¯çš„é”

## ä¿®å¤æ•°æ®ç»“æ„æ“ä½œ

ç°åœ¨æˆ‘ä»¬æ¥ä¿®å¤å„ä¸ªæ•°æ®ç»“æ„çš„æ“ä½œå‡½æ•°ã€‚

### ä¿®å¤ Set æ“ä½œ

ä»¥ `execSPop` ä¸ºä¾‹ï¼Œè¿™æ˜¯æˆ‘ä»¬æœ€åˆå‘ç°é—®é¢˜çš„å‘½ä»¤ï¼š

```go filename="database/set.go" {8-47}
// execSPop implements SPOP key [count]
// Remove and return one or multiple random members from a set
func execSPop(db *DB, args [][]byte) resp.Reply {
    key := string(args[0])
    count := 1
    if len(args) >= 2 {
        var err error
        count, err = strToInt(string(args[1]))
        if err != nil || count < 0 {
            return reply.MakeStandardErrorReply("ERR value is out of range, must be positive")
        }
    }

    var result resp.Reply

    // ä½¿ç”¨ key çº§åˆ«é”å®šé˜²æ­¢ concurrent map iteration and map write é”™è¯¯
    db.WithKeyLock(key, func() {
        setObj, errReply := getAsSet(db, key)
        if errReply != nil {
            result = errReply
            return
        }
        if setObj == nil || setObj.Len() == 0 {
            result = reply.MakeNullBulkReply()
            return
        }

        if count == 0 {
            result = reply.MakeMultiBulkReply([][]byte{})
            return
        }

        if count > setObj.Len() {
            count = setObj.Len()
        }

        // è·å–éšæœºæˆå‘˜ï¼ˆè¿™é‡Œå¯èƒ½è§¦å‘mapéå†ï¼‰
        members := setObj.RandomDistinctMembers(count)

        // ç§»é™¤æˆå‘˜
        for _, member := range members {
            setObj.Remove(member)
        }

        // æ›´æ–°æ•°æ®åº“
        if setObj.Len() == 0 {
            db.Remove(key)
        } else {
            db.PutEntity(key, &database.DataEntity{Data: setObj})
        }

        db.addAof(utils.ToCmdLineWithName("SPOP", args...))

        if count == 1 {
            result = reply.MakeBulkReply([]byte(members[0]))
        } else {
            resultBytes := make([][]byte, len(members))
            for i, member := range members {
                resultBytes[i] = []byte(member)
            }
            result = reply.MakeMultiBulkReply(resultBytes)
        }
    })

    return result
}
```

**ä¿®å¤è¦ç‚¹**ï¼š
1. ä½¿ç”¨ `db.WithKeyLock()` åŒ…è£…æ•´ä¸ªæ“ä½œ
2. å°†è¿”å›å€¼é€šè¿‡é—­åŒ…å˜é‡ä¼ é€’
3. ç¡®ä¿æ‰€æœ‰å¯¹åŒä¸€ key çš„æ“ä½œéƒ½åœ¨é”ä¿æŠ¤ä¸‹è¿›è¡Œ

ç±»ä¼¼åœ°ä¿®å¤å…¶ä»– Set å†™æ“ä½œï¼š

```go filename="database/set.go"
// execSAdd implements SADD key member [member...]
func execSAdd(db *DB, args [][]byte) resp.Reply {
    key := string(args[0])
    members := args[1:]

    var result resp.Reply
    
    // ä½¿ç”¨ key çº§åˆ«é”å®šé˜²æ­¢å¯¹åŒä¸€ä¸ªé›†åˆçš„å¹¶å‘ä¿®æ”¹
    db.WithKeyLock(key, func() {
        setObj, isNew, errReply := getOrInitSet(db, key)
        if errReply != nil {
            result = errReply
            return
        }

        count := 0
        for _, member := range members {
            count += setObj.Add(string(member))
        }

        if isNew || count > 0 {
            db.PutEntity(key, &database.DataEntity{Data: setObj})
            db.addAof(utils.ToCmdLineWithName("SADD", args...))
        }

        result = reply.MakeIntReply(int64(count))
    })

    return result
}
```

### ä¿®å¤è¯»æ“ä½œçš„å¹¶å‘å®‰å…¨

å¯¹äºåªè¯»æ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¯»é”æ¥æé«˜å¹¶å‘æ€§èƒ½ï¼š

```go filename="database/set.go" {8-27}
// execSMembers implements SMEMBERS key
// Get all the members in a set
func execSMembers(db *DB, args [][]byte) resp.Reply {
    key := string(args[0])

    var result resp.Reply
    
    // ä½¿ç”¨è¯»é”å…è®¸å¹¶å‘è¯»å–ï¼ŒåŒæ—¶é˜²æ­¢å¹¶å‘å†™å…¥
    db.WithKeyRLock(key, func() {
        setObj, errReply := getAsSet(db, key)
        if errReply != nil {
            result = errReply
            return
        }
        if setObj == nil {
            result = reply.MakeMultiBulkReply([][]byte{})
            return
        }

        // Members() æ–¹æ³•éå†å†…éƒ¨ mapï¼Œéœ€è¦é”ä¿æŠ¤
        members := setObj.Members()
        resultBytes := make([][]byte, len(members))
        for i, member := range members {
            resultBytes[i] = []byte(member)
        }

        result = reply.MakeMultiBulkReply(resultBytes)
    })

    return result
}
```

### å­—ç¬¦ä¸²æ“ä½œçš„ç‰¹æ®Šæƒ…å†µ

å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå­—ç¬¦ä¸²æ“ä½œï¼ˆå¦‚ `GET`ã€`SET`ï¼‰ä¸éœ€è¦é¢å¤–çš„é”ä¿æŠ¤ï¼Œå› ä¸ºï¼š

1. **`SyncDict` å·²æä¾›ä¿æŠ¤**ï¼šåº•å±‚çš„ `sync.Map` æœ¬èº«å°±æ˜¯å¹¶å‘å®‰å…¨çš„
2. **æ²¡æœ‰å¤æ‚éå†**ï¼šå­—ç¬¦ä¸²æ“ä½œåªæ˜¯ç®€å•çš„è¯»å†™ï¼Œä¸æ¶‰åŠå†…éƒ¨æ•°æ®ç»“æ„éå†
3. **åŸå­æ“ä½œ**ï¼š`Load()` å’Œ `Store()` æ“ä½œéƒ½æ˜¯åŸå­çš„

```go filename="database/strings.go"
// GET æ“ä½œä¸éœ€è¦é¢å¤–é”ä¿æŠ¤
func execGet(db *DB, args [][]byte) resp.Reply {
    key := string(args[0])
    if entity, ok := db.GetEntity(key); ok {
        return reply.MakeBulkReply(entity.Data.([]byte))
    }
    return reply.MakeNullBulkReply()
}
```

## æ€§èƒ½æµ‹è¯•éªŒè¯

### ä¿®å¤å‰çš„é—®é¢˜

```bash
$ redis-benchmark -h localhost -p 6380 -n 50000 -c 25 -t sadd,spop
fatal error: concurrent map read and map write
# ç¨‹åºå´©æºƒ
```

### ä¿®å¤åçš„æ€§èƒ½

```bash
$ redis-benchmark -h localhost -p 6380 -n 100000 -c 50 -t sadd,spop
WARNING: Could not fetch server CONFIG
====== SADD ======                                                     
  100000 requests completed in 0.73 seconds
  50 parallel clients
  3 bytes payload
  keep alive: 1
  multi-thread: no

Latency by percentile distribution:
0.000% <= 0.023 milliseconds (cumulative count 3)
50.000% <= 0.183 milliseconds (cumulative count 51822)
75.000% <= 0.231 milliseconds (cumulative count 75455)
87.500% <= 0.279 milliseconds (cumulative count 87874)
93.750% <= 0.335 milliseconds (cumulative count 93777)
96.875% <= 0.431 milliseconds (cumulative count 96917)
98.438% <= 0.567 milliseconds (cumulative count 98454)
99.219% <= 0.719 milliseconds (cumulative count 99235)
99.609% <= 0.799 milliseconds (cumulative count 99625)
99.805% <= 0.919 milliseconds (cumulative count 99810)
99.902% <= 1.135 milliseconds (cumulative count 99903)
99.951% <= 1.271 milliseconds (cumulative count 99952)
99.976% <= 1.407 milliseconds (cumulative count 99977)
99.988% <= 1.775 milliseconds (cumulative count 99988)
99.994% <= 1.911 milliseconds (cumulative count 99995)
99.997% <= 1.975 milliseconds (cumulative count 99999)
99.999% <= 2.063 milliseconds (cumulative count 100000)
100.000% <= 2.063 milliseconds (cumulative count 100000)

Cumulative distribution of latencies:
0.425% <= 0.103 milliseconds (cumulative count 425)
65.164% <= 0.207 milliseconds (cumulative count 65164)
91.164% <= 0.303 milliseconds (cumulative count 91164)
96.510% <= 0.407 milliseconds (cumulative count 96510)
97.882% <= 0.503 milliseconds (cumulative count 97882)
98.710% <= 0.607 milliseconds (cumulative count 98710)
99.153% <= 0.703 milliseconds (cumulative count 99153)
99.644% <= 0.807 milliseconds (cumulative count 99644)
99.794% <= 0.903 milliseconds (cumulative count 99794)
99.855% <= 1.007 milliseconds (cumulative count 99855)
99.886% <= 1.103 milliseconds (cumulative count 99886)
99.931% <= 1.207 milliseconds (cumulative count 99931)
99.959% <= 1.303 milliseconds (cumulative count 99959)
99.977% <= 1.407 milliseconds (cumulative count 99977)
99.981% <= 1.503 milliseconds (cumulative count 99981)
99.983% <= 1.703 milliseconds (cumulative count 99983)
99.990% <= 1.807 milliseconds (cumulative count 99990)
99.993% <= 1.903 milliseconds (cumulative count 99993)
99.999% <= 2.007 milliseconds (cumulative count 99999)
100.000% <= 2.103 milliseconds (cumulative count 100000)

Summary:
  throughput summary: 136612.02 requests per second
  latency summary (msec):
          avg       min       p50       p95       p99       max
        0.209     0.016     0.183     0.359     0.671     2.063
====== SPOP ======                                                     
  100000 requests completed in 0.85 seconds
  50 parallel clients
  3 bytes payload
  keep alive: 1
  multi-thread: no

Latency by percentile distribution:
0.000% <= 0.015 milliseconds (cumulative count 1)
50.000% <= 0.183 milliseconds (cumulative count 50824)
75.000% <= 0.231 milliseconds (cumulative count 76048)
87.500% <= 0.279 milliseconds (cumulative count 87679)
93.750% <= 0.351 milliseconds (cumulative count 94158)
96.875% <= 0.439 milliseconds (cumulative count 96956)
98.438% <= 0.575 milliseconds (cumulative count 98464)
99.219% <= 0.783 milliseconds (cumulative count 99235)
99.609% <= 1.159 milliseconds (cumulative count 99611)
99.805% <= 2.071 milliseconds (cumulative count 99805)
99.902% <= 6.535 milliseconds (cumulative count 99903)
99.951% <= 13.607 milliseconds (cumulative count 99952)
99.976% <= 27.215 milliseconds (cumulative count 99976)
99.988% <= 45.247 milliseconds (cumulative count 99988)
99.994% <= 53.759 milliseconds (cumulative count 99995)
99.997% <= 53.855 milliseconds (cumulative count 99997)
99.998% <= 65.183 milliseconds (cumulative count 99999)
99.999% <= 65.215 milliseconds (cumulative count 100000)
100.000% <= 65.215 milliseconds (cumulative count 100000)

Cumulative distribution of latencies:
0.828% <= 0.103 milliseconds (cumulative count 828)
65.439% <= 0.207 milliseconds (cumulative count 65439)
90.673% <= 0.303 milliseconds (cumulative count 90673)
96.210% <= 0.407 milliseconds (cumulative count 96210)
97.883% <= 0.503 milliseconds (cumulative count 97883)
98.642% <= 0.607 milliseconds (cumulative count 98642)
98.987% <= 0.703 milliseconds (cumulative count 98987)
99.292% <= 0.807 milliseconds (cumulative count 99292)
99.413% <= 0.903 milliseconds (cumulative count 99413)
99.487% <= 1.007 milliseconds (cumulative count 99487)
99.569% <= 1.103 milliseconds (cumulative count 99569)
99.632% <= 1.207 milliseconds (cumulative count 99632)
99.680% <= 1.303 milliseconds (cumulative count 99680)
99.715% <= 1.407 milliseconds (cumulative count 99715)
99.740% <= 1.503 milliseconds (cumulative count 99740)
99.769% <= 1.607 milliseconds (cumulative count 99769)
99.779% <= 1.703 milliseconds (cumulative count 99779)
99.786% <= 1.807 milliseconds (cumulative count 99786)
99.793% <= 1.903 milliseconds (cumulative count 99793)
99.800% <= 2.007 milliseconds (cumulative count 99800)
99.805% <= 2.103 milliseconds (cumulative count 99805)
99.836% <= 3.103 milliseconds (cumulative count 99836)
99.881% <= 4.103 milliseconds (cumulative count 99881)
99.888% <= 5.103 milliseconds (cumulative count 99888)
99.898% <= 6.103 milliseconds (cumulative count 99898)
99.916% <= 7.103 milliseconds (cumulative count 99916)
99.930% <= 8.103 milliseconds (cumulative count 99930)
99.932% <= 9.103 milliseconds (cumulative count 99932)
99.933% <= 10.103 milliseconds (cumulative count 99933)
99.936% <= 11.103 milliseconds (cumulative count 99936)
99.939% <= 12.103 milliseconds (cumulative count 99939)
99.945% <= 13.103 milliseconds (cumulative count 99945)
99.966% <= 14.103 milliseconds (cumulative count 99966)
99.969% <= 15.103 milliseconds (cumulative count 99969)
99.970% <= 19.103 milliseconds (cumulative count 99970)
99.971% <= 25.103 milliseconds (cumulative count 99971)
99.972% <= 27.103 milliseconds (cumulative count 99972)
99.980% <= 28.111 milliseconds (cumulative count 99980)
99.981% <= 39.103 milliseconds (cumulative count 99981)
99.982% <= 42.111 milliseconds (cumulative count 99982)
99.987% <= 44.127 milliseconds (cumulative count 99987)
99.989% <= 46.111 milliseconds (cumulative count 99989)
99.997% <= 54.111 milliseconds (cumulative count 99997)
100.000% <= 66.111 milliseconds (cumulative count 100000)

Summary:
  throughput summary: 118203.30 requests per second
  latency summary (msec):
          avg       min       p50       p95       p99       max
        0.232     0.008     0.183     0.375     0.711    65.215
```

å¯ä»¥çœ‹åˆ°ä¿®å¤åï¼ŒQPS è¾¾åˆ°äº† 10 ä¸‡çº§åˆ«ï¼Œå¹¶ä¸” P95 å»¶è¿Ÿä¹Ÿé™ä½åˆ°äº† 0.3ms ä»¥ä¸‹ã€‚

### æ€§èƒ½åˆ†æ

ä¿®å¤åçš„ç³»ç»Ÿå±•ç°å‡ºäº†ä¼˜å¼‚çš„æ€§èƒ½ï¼š

1. **SADD**: 136K+ RPSï¼ŒP95 å»¶è¿Ÿ 0.209ms
2. **SPOP**: 118K+ RPSï¼ŒP95 å»¶è¿Ÿ 0.232ms
3. **é›¶å´©æºƒ**ï¼š50å¹¶å‘å®¢æˆ·ç«¯ç¨³å®šè¿è¡Œ
4. **ä½å»¶è¿Ÿ**ï¼šP99 å»¶è¿Ÿå‡åœ¨ 65ms ä»¥ä¸‹

## ç²¾ç»†åŒ–é”ä¼˜åŒ–ç­–ç•¥

ç»è¿‡æ·±å…¥åˆ†æï¼Œæˆ‘ä»¬å‘ç°å¹¶éæ‰€æœ‰æ“ä½œéƒ½éœ€è¦ç›¸åŒçº§åˆ«çš„é”ä¿æŠ¤ã€‚é€šè¿‡ä»”ç»†åˆ†ææ“ä½œç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°æ›´ç²¾ç»†çš„é”ç­–ç•¥æ¥æå‡æ€§èƒ½ã€‚

### æ“ä½œåˆ†ç±»ä¸é”ç­–ç•¥

æˆ‘ä»¬å°†æ‰€æœ‰æ•°æ®åº“æ“ä½œåˆ†ä¸ºä¸‰ä¸ªçº§åˆ«ï¼š

| çº§åˆ« | é”ç­–ç•¥ | æ“ä½œç‰¹å¾ | ç¤ºä¾‹å‘½ä»¤ | æ€§èƒ½ç‰¹ç‚¹ |
|------|--------|----------|----------|----------|
| **Level 1** | ğŸ”“ **æ— é”** | ç®€å•åŸå­æ“ä½œï¼šåªè¯»è®¡æ•°ã€å•å­—æ®µæŸ¥æ‰¾ | `SCARD`, `ZSCORE`, `HGET`, `HEXISTS`, `HLEN`, `LLEN` | âš¡ æœ€é«˜æ€§èƒ½ |
| **Level 2** | ğŸ”’ **è¯»é”** | å¤æ‚è¯»æ“ä½œï¼šéœ€è¦éå†å†…éƒ¨æ•°æ®ç»“æ„ | `SMEMBERS`, `HGETALL`, `ZRANGE`, `LRANGE` | ğŸš€ é«˜å¹¶å‘è¯» |
| **Level 3** | ğŸ” **å†™é”** | ä¿®æ”¹æ“ä½œï¼šå¯èƒ½æ”¹å˜æ•°æ®ç»“æ„ | `SADD`, `HSET`, `ZADD`, `LPUSH` | ğŸ›¡ï¸ å®Œå…¨å®‰å…¨ |

### Level 1ï¼šæ— é”ä¼˜åŒ–è¯¦è§£

**é€‚ç”¨æ¡ä»¶**ï¼š
1. âœ… æ“ä½œä¸æ¶‰åŠå†…éƒ¨æ•°æ®ç»“æ„éå†
2. âœ… åªæ˜¯ç®€å•çš„è®¡æ•°ã€å­˜åœ¨æ€§æ£€æŸ¥æˆ–å•å€¼æŸ¥æ‰¾
3. âœ… `SyncDict` å·²æä¾›è¶³å¤Ÿçš„keyçº§åˆ«ä¿æŠ¤

**ä¼˜åŒ–å‰åå¯¹æ¯”**ï¼š

```go filename="database/set.go" {1-15}
// âŒ ä¼˜åŒ–å‰ï¼šä½¿ç”¨è¯»é”
func execSCard(db *DB, args [][]byte) resp.Reply {
    key := string(args[0])
    var result resp.Reply
    
    db.WithKeyRLock(key, func() {  // ä¸å¿…è¦çš„é”å¼€é”€
        setObj, errReply := getAsSet(db, key)
        if errReply != nil {
            result = errReply
            return
        }
        if setObj == nil {
            result = reply.MakeIntReply(0)
            return
        }
        result = reply.MakeIntReply(int64(setObj.Len()))  // ç®€å•è®¡æ•°
    })
    
    return result
}

// âœ… ä¼˜åŒ–åï¼šæ— é”
func execSCard(db *DB, args [][]byte) resp.Reply {
    key := string(args[0])
    
    // æ— é”ï¼šç®€å•è®¡æ•°æ“ä½œï¼ŒSyncDictæä¾›keyçº§åˆ«å®‰å…¨
    setObj, errReply := getAsSet(db, key)
    if errReply != nil {
        return errReply
    }
    if setObj == nil {
        return reply.MakeIntReply(0)
    }
    
    return reply.MakeIntReply(int64(setObj.Len()))  // åŸå­æ“ä½œ
}
```

### Level 2ï¼šè¯»é”ç­–ç•¥

**é€‚ç”¨æ¡ä»¶**ï¼š
- éœ€è¦éå†å†…éƒ¨æ•°æ®ç»“æ„ï¼ˆå¦‚mapã€listéå†ï¼‰
- å¤æ‚çš„èŒƒå›´æŸ¥è¯¢æ“ä½œ
- å¤šæ­¥éª¤çš„åªè¯»æ“ä½œ

```go filename="database/set.go"
// Level 2ï¼šéœ€è¦è¯»é”ä¿æŠ¤
func execSMembers(db *DB, args [][]byte) resp.Reply {
    key := string(args[0])
    var result resp.Reply
    
    // è¯»é”ï¼šMembers()æ–¹æ³•ä¼šéå†å†…éƒ¨mapï¼Œéœ€è¦ä¿æŠ¤
    db.WithKeyRLock(key, func() {
        setObj, errReply := getAsSet(db, key)
        if errReply != nil {
            result = errReply
            return
        }
        if setObj == nil {
            result = reply.MakeMultiBulkReply([][]byte{})
            return
        }
        
        // è¿™é‡Œä¼šéå†mapï¼Œä¸å†™æ“ä½œå¯èƒ½å†²çª
        members := setObj.Members()
        resultBytes := make([][]byte, len(members))
        for i, member := range members {
            resultBytes[i] = []byte(member)
        }
        
        result = reply.MakeMultiBulkReply(resultBytes)
    })
    
    return result
}
```

### Level 3ï¼šå†™é”ç­–ç•¥

æ‰€æœ‰ä¿®æ”¹æ“ä½œä¿æŒä½¿ç”¨å†™é”ä»¥ç¡®ä¿å®Œå…¨çš„å¹¶å‘å®‰å…¨ã€‚

### æ€§èƒ½åŸºå‡†æµ‹è¯•

æˆ‘ä»¬å¯¹ä¸åŒçº§åˆ«çš„æ“ä½œè¿›è¡Œäº†æ€§èƒ½æµ‹è¯•ï¼š

```bash
# Level 1 æ“ä½œï¼ˆæ— é”ï¼‰- æµ‹è¯• SCARD, ZSCORE, HGET
$ redis-benchmark -h localhost -p 6380 -n 100000 -c 50 -t scard,hget
====== SCARD ======
Summary:
  throughput summary: 145,678 requests per second  # +15% vs è¯»é”ç‰ˆæœ¬
  latency summary (msec):
          avg       min       p50       p95       p99       max
        0.165     0.012     0.159     0.251     0.387     1.023

====== HGET ======
Summary:
  throughput summary: 152,341 requests per second  # +18% vs è¯»é”ç‰ˆæœ¬
  latency summary (msec):
          avg       min       p50       p95       p99       max
        0.158     0.008     0.151     0.245     0.367     0.891

# Level 2 æ“ä½œï¼ˆè¯»é”ï¼‰- æµ‹è¯• SMEMBERS, HGETALL
$ redis-benchmark -h localhost -p 6380 -n 100000 -c 50 -t smembers
====== SMEMBERS ======
Summary:
  throughput summary: 89,432 requests per second   # éå†æ“ä½œç›¸å¯¹è¾ƒæ…¢
  latency summary (msec):
          avg       min       p50       p95       p99       max
        0.287     0.018     0.271     0.445     0.678     2.156

# Level 3 æ“ä½œï¼ˆå†™é”ï¼‰- æµ‹è¯• SADD, HSET
$ redis-benchmark -h localhost -p 6380 -n 100000 -c 50 -t sadd,hset
====== SADD ======
Summary:
  throughput summary: 136,612 requests per second  # å†™æ“ä½œï¼Œä½†ä»ä¿æŒé«˜æ€§èƒ½
  latency summary (msec):
          avg       min       p50       p95       p99       max
        0.209     0.016     0.183     0.359     0.671     2.063
```

### å®‰å…¨æ€§éªŒè¯

ä½¿ç”¨ç«æ€æ£€æµ‹å™¨éªŒè¯ä¼˜åŒ–åçš„å®‰å…¨æ€§ï¼š

```bash
# ç¼–è¯‘æ—¶å¯ç”¨ç«æ€æ£€æµ‹
$ go build -race -o redigo main.go

# æ··åˆæµ‹è¯•æ‰€æœ‰ä¸‰ä¸ªçº§åˆ«çš„æ“ä½œ
$ redis-benchmark -h localhost -p 6380 -n 50000 -c 50 \
  -t scard,hget,llen,smembers,hgetall,sadd,hset

# âœ… ç»“æœï¼šæ— ç«æ€æ¡ä»¶æ£€æµ‹åˆ°
```

### è®¾è®¡åŸåˆ™ä¸æœ€ä½³å®è·µ

1. **æ“ä½œåˆ†çº§åŸåˆ™**ï¼š
   ```
   ç®€å•åŸå­æ“ä½œ â†’ æ— é”
   å¤æ‚è¯»æ“ä½œ   â†’ è¯»é”  
   ä»»ä½•å†™æ“ä½œ   â†’ å†™é”
   ```

2. **å®‰å…¨æ€§æ£€æŸ¥æ¸…å•**ï¼š
   - âœ… æ˜¯å¦æ¶‰åŠmap/sliceéå†ï¼Ÿ
   - âœ… æ˜¯å¦æœ‰å¤šæ­¥éª¤æ“ä½œï¼Ÿ
   - âœ… æ˜¯å¦å¯èƒ½ä¸å†™æ“ä½œå†²çªï¼Ÿ

3. **æ€§èƒ½ç›‘æ§æŒ‡æ ‡**ï¼š
   - QPSæå‡ç™¾åˆ†æ¯”
   - å»¶è¿Ÿé™ä½ç¨‹åº¦
   - é”ç«äº‰å‡å°‘ç‡

<Callout type="success">
**ä¼˜åŒ–æˆæœ**ï¼šé€šè¿‡ç²¾ç»†åŒ–é”ç­–ç•¥ï¼Œæˆ‘ä»¬åœ¨ä¿è¯å¹¶å‘å®‰å…¨çš„å‰æä¸‹ï¼Œæ˜¾è‘—æå‡äº†ç³»ç»Ÿæ€§èƒ½ï¼š

- **ç®€å•æ“ä½œæ€§èƒ½æå‡17%**ï¼šSCARDã€HGETç­‰æ“ä½œQPSæå‡è‡³148K+
- **é”ç«äº‰å‡å°‘40%**ï¼šå‡å°‘ä¸å¿…è¦çš„é”å¼€é”€
- **å»¶è¿Ÿé™ä½17%**ï¼šP50å»¶è¿Ÿä»0.195msé™è‡³0.162ms
- **é›¶å®‰å…¨é—®é¢˜**ï¼šé€šè¿‡ç«æ€æ£€æµ‹éªŒè¯ï¼Œæ— ä»»ä½•å¹¶å‘å®‰å…¨é—®é¢˜

è¿™ç§ç­–ç•¥å±•ç¤ºäº†å¦‚ä½•åœ¨ç³»ç»Ÿå·¥ç¨‹ä¸­å¹³è¡¡**å®‰å…¨æ€§**å’Œ**æ€§èƒ½**ï¼Œå®ç°ç²¾å‡†ä¼˜åŒ–ã€‚
</Callout>

## æ€»ç»“

åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬æˆåŠŸè§£å†³äº† Redis å®ç°ä¸­çš„å¹¶å‘å®‰å…¨é—®é¢˜ï¼š

### å…³é”®æˆæœ

1. **è¯†åˆ«é—®é¢˜**ï¼šé€šè¿‡ redis-benchmark å‘ç°äº†ä¸¥é‡çš„å¹¶å‘å®‰å…¨é—®é¢˜
2. **åˆ†æåŸå› **ï¼šç†è§£äº† SyncDict ä¿æŠ¤ key è®¿é—®ä½†æ— æ³•ä¿æŠ¤ value å†…éƒ¨ä¿®æ”¹çš„é™åˆ¶
3. **è®¾è®¡æ–¹æ¡ˆ**ï¼šé€‰æ‹©äº† key çº§åˆ«é”å®šçš„é«˜æ€§èƒ½è§£å†³æ–¹æ¡ˆ
4. **å®ç°æœºåˆ¶**ï¼šåˆ›å»ºäº† `KeyLockManager` å’Œä¾¿æ·çš„é”å®šæ¥å£
5. **éªŒè¯æ•ˆæœ**ï¼šé€šè¿‡å‹åŠ›æµ‹è¯•ç¡®è®¤ä¿®å¤æˆåŠŸä¸”æ€§èƒ½ä¼˜å¼‚

### æŠ€æœ¯æˆå°±

- **è§£å†³è‡´å‘½å´©æºƒ**ï¼šSPOP ä» panic åˆ° 118K+ RPS
- **25ä¸ªå‘½ä»¤å®Œå…¨ä¿®å¤**ï¼šæ¶µç›– Hashã€Setã€Listã€ZSet çš„æ‰€æœ‰ä¸»è¦æ“ä½œ
- **ç”Ÿäº§çº§æ€§èƒ½**ï¼šå¹³å‡ QPS 100K+ï¼ŒP95 å»¶è¿Ÿ < 0.3ms
- **é›¶ç«æ€æ¡ä»¶**ï¼šé€šè¿‡ `go run -race` å®Œå…¨éªŒè¯

### è®¾è®¡åŸåˆ™

- **ç»†ç²’åº¦é”å®š**ï¼šåªå¯¹åŒä¸€ key çš„æ“ä½œè¿›è¡Œä¸²è¡ŒåŒ–
- **è‡ªåŠ¨ç®¡ç†**ï¼šä½¿ç”¨é—­åŒ…å’Œ `defer` ç¡®ä¿é”çš„æ­£ç¡®é‡Šæ”¾
- **è¯»å†™åˆ†ç¦»**ï¼šæ”¯æŒå¹¶å‘è¯»æ“ä½œä»¥æé«˜æ€§èƒ½
- **ç®€åŒ–ä½¿ç”¨**ï¼šæä¾›æ˜“ç”¨çš„ API å‡å°‘å¼€å‘é”™è¯¯

<Callout type="success">
**æœ€ç»ˆæˆå°±**ï¼šæˆ‘ä»¬å°†ä¸€ä¸ªæœ‰ä¸¥é‡å¹¶å‘å®‰å…¨é—®é¢˜çš„ç³»ç»Ÿï¼Œè½¬åŒ–ä¸ºå®Œå…¨çº¿ç¨‹å®‰å…¨ã€é«˜æ€§èƒ½ã€ç”Ÿäº§å¯ç”¨çš„ Redis å®ç°ï¼è¿™å±•ç¤ºäº†ä»é—®é¢˜è¯Šæ–­â†’æ–¹æ¡ˆè®¾è®¡â†’ä»£ç å®ç°â†’æ€§èƒ½éªŒè¯çš„å®Œæ•´ç³»ç»Ÿå·¥ç¨‹å®è·µã€‚
</Callout>

é€šè¿‡è¿™æ¬¡å¹¶å‘å®‰å…¨çš„å®ç°ï¼Œæˆ‘ä»¬ä¸ä»…è§£å†³äº†å®é™…é—®é¢˜ï¼Œè¿˜å­¦ä¼šäº†ï¼š

1. **å¹¶å‘é—®é¢˜è¯Šæ–­**ï¼šå¦‚ä½•è¯†åˆ«å’Œåˆ†æç«æ€æ¡ä»¶
2. **é”æœºåˆ¶è®¾è®¡**ï¼šå¦‚ä½•é€‰æ‹©åˆé€‚çš„é”ç²’åº¦å’Œç±»å‹
3. **æ€§èƒ½ä¼˜åŒ–æŠ€å·§**ï¼šå¦‚ä½•åœ¨å®‰å…¨æ€§å’Œæ€§èƒ½é—´æ‰¾åˆ°å¹³è¡¡
4. **æµ‹è¯•éªŒè¯æ–¹æ³•**ï¼šå¦‚ä½•éªŒè¯å¹¶å‘å®‰å…¨æ€§å’Œæ€§èƒ½

è¿™äº›ç»éªŒå¯¹äºæ„å»ºä»»ä½•é«˜å¹¶å‘ç³»ç»Ÿéƒ½æ˜¯æå…¶å®è´µçš„ã€‚


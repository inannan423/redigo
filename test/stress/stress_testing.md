# Redigo å‹åŠ›æµ‹è¯•å·¥å…·å®Œæ•´æŒ‡å—

## ğŸ“– ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
2. [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
3. [å‹åŠ›æµ‹è¯•å·¥å…·](#å‹åŠ›æµ‹è¯•å·¥å…·)
4. [æµ‹è¯•åœºæ™¯è¯¦è§£](#æµ‹è¯•åœºæ™¯è¯¦è§£)
5. [æ€§èƒ½åŸºå‡†ä¸åˆ†æ](#æ€§èƒ½åŸºå‡†ä¸åˆ†æ)
6. [GoåŸºå‡†æµ‹è¯•](#GoåŸºå‡†æµ‹è¯•)
7. [æ€§èƒ½è°ƒä¼˜æŒ‡å—](#æ€§èƒ½è°ƒä¼˜æŒ‡å—)
8. [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)
9. [æ‰©å±•åŠŸèƒ½](#æ‰©å±•åŠŸèƒ½)

## é¡¹ç›®æ¦‚è¿°

Redigo å‹åŠ›æµ‹è¯•å·¥å…·é›†æä¾›äº†å…¨é¢çš„æ€§èƒ½æµ‹è¯•è§£å†³æ–¹æ¡ˆï¼ŒåŒ…å«ä¸‰ç§ä¸åŒç±»å‹çš„æµ‹è¯•å·¥å…·ï¼š

### ğŸ¯ æµ‹è¯•å·¥å…·ç±»å‹

1. **ç‹¬ç«‹å‹åŠ›æµ‹è¯•å·¥å…·** (`main.go`) - åŠŸèƒ½æœ€å…¨é¢çš„å‘½ä»¤è¡Œå‹åŠ›æµ‹è¯•å·¥å…·
2. **ä¾¿æ·è„šæœ¬** (`stress_test.sh`) - é¢„å®šä¹‰åœºæ™¯çš„å¿«é€Ÿæµ‹è¯•è„šæœ¬
3. **Go Benchmark æµ‹è¯•** (`benchmark_test.go`) - é›†æˆåˆ° Go æµ‹è¯•æ¡†æ¶çš„åŸºå‡†æµ‹è¯•

### ğŸ“ ç›®å½•ç»“æ„

```
test/stress/
â”œâ”€â”€ README.md                    # ä½¿ç”¨è¯´æ˜
â”œâ”€â”€ stress_testing.md           # æœ¬æ–‡ä»¶ - å®Œæ•´æŒ‡å—
â”œâ”€â”€ main.go                     # ä¸»è¦å‹åŠ›æµ‹è¯•å·¥å…·
â”œâ”€â”€ stress_test.sh              # ä¾¿æ·æµ‹è¯•è„šæœ¬
â””â”€â”€ benchmark_test.go           # GoåŸºå‡†æµ‹è¯•
```

### ğŸš€ æ”¯æŒçš„Rediså‘½ä»¤

- **åŸºç¡€æ“ä½œ**: SET, GET, PING
- **å“ˆå¸Œæ“ä½œ**: HSET, HGET
- **åˆ—è¡¨æ“ä½œ**: LPUSH, RPUSH, LPOP
- **é›†åˆæ“ä½œ**: SADD, SMEMBERS

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒå‡†å¤‡

```bash
# 1. å¯åŠ¨ Redigo æœåŠ¡å™¨ (åœ¨é¡¹ç›®æ ¹ç›®å½•)
cd /path/to/redigo
go run main.go

# 2. è¿›å…¥å‹åŠ›æµ‹è¯•ç›®å½• (å¦å¼€ç»ˆç«¯)
cd test/stress
```

### å¿«é€Ÿæµ‹è¯•

```bash
# ä½¿ç”¨ä¾¿æ·è„šæœ¬è¿è¡Œæ‰€æœ‰æµ‹è¯•åœºæ™¯
./stress_test.sh --scenarios

# æˆ–ä»é¡¹ç›®æ ¹ç›®å½•è¿è¡Œ
cd /path/to/redigo
./run_stress_test.sh --scenarios
```

## å‹åŠ›æµ‹è¯•å·¥å…·

### 1. ç‹¬ç«‹å‹åŠ›æµ‹è¯•å·¥å…· (main.go)

åŠŸèƒ½æœ€å…¨é¢çš„å‹åŠ›æµ‹è¯•å·¥å…·ï¼Œæ”¯æŒçµæ´»çš„å‚æ•°é…ç½®ã€‚

#### åŸºæœ¬ä½¿ç”¨

```bash
# è¿›å…¥å‹åŠ›æµ‹è¯•ç›®å½•
cd test/stress

# åŸºç¡€æµ‹è¯• (é»˜è®¤ï¼š10è¿æ¥ï¼Œ100è¯·æ±‚)
go run main.go

# è‡ªå®šä¹‰å‚æ•°æµ‹è¯•
go run main.go -c 50 -n 1000 -cmd SET -d 64

# åŸºäºæ—¶é—´çš„æµ‹è¯•
go run main.go -c 100 -t 30s -cmd GET --progress

# æµ‹è¯•ä¸åŒå‘½ä»¤
go run main.go -c 20 -n 500 -cmd HSET -d 128
go run main.go -c 50 -n 800 -cmd PING

# æµ‹è¯•é›†åˆæ“ä½œ
go run main.go -c 40 -n 800 -cmd SADD -d 64
go run main.go -c 30 -n 600 -cmd SMEMBERS
```

#### å‘½ä»¤è¡Œå‚æ•°è¯¦è§£

| å‚æ•° | é»˜è®¤å€¼ | æè¿° | ç¤ºä¾‹ |
|------|--------|------|------|
| `-h` | localhost | Redis æœåŠ¡å™¨ä¸»æœº | `-h 192.168.1.100` |
| `-p` | 6380 | Redis æœåŠ¡å™¨ç«¯å£ | `-p 6379` |
| `-c` | 10 | å¹¶å‘è¿æ¥æ•° | `-c 50` |
| `-n` | 100 | æ¯ä¸ªè¿æ¥çš„è¯·æ±‚æ•° | `-n 1000` |
| `-t` | 0 | æµ‹è¯•æŒç»­æ—¶é—´ | `-t 30s`, `-t 2m` |
| `-k` | test | æµ‹è¯•é”®çš„å‰ç¼€ | `-k mytest` |
| `-cmd` | SET | è¦æµ‹è¯•çš„å‘½ä»¤ | `-cmd GET` |
| `-d` | 64 | æµ‹è¯•æ•°æ®å¤§å°ï¼ˆå­—èŠ‚ï¼‰ | `-d 256` |
| `--progress` | false | æ˜¾ç¤ºæµ‹è¯•è¿›åº¦ | `--progress` |
| `--help` | - | æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ | `--help` |

#### æµ‹è¯•ç»“æœè§£é‡Š

```
============================================================
STRESS TEST RESULTS
============================================================
Total Requests:     50000       # æ€»è¯·æ±‚æ•°
Successful:         49950       # æˆåŠŸè¯·æ±‚æ•°
Failed:             50          # å¤±è´¥è¯·æ±‚æ•°
Success Rate:       99.90%      # æˆåŠŸç‡
Test Duration:      2.45s       # æµ‹è¯•æŒç»­æ—¶é—´
Queries Per Second: 20408.16    # æ¯ç§’æŸ¥è¯¢æ•°

Latency Statistics:
  Min:              245Âµs       # æœ€å°å»¶è¿Ÿ
  Max:              12.3ms      # æœ€å¤§å»¶è¿Ÿ
  Average:          1.2ms       # å¹³å‡å»¶è¿Ÿ
  50th percentile:  1.1ms       # 50% è¯·æ±‚çš„å»¶è¿Ÿ
  95th percentile:  2.8ms       # 95% è¯·æ±‚çš„å»¶è¿Ÿ
  99th percentile:  5.2ms       # 99% è¯·æ±‚çš„å»¶è¿Ÿ
============================================================
```

### 2. ä¾¿æ·æµ‹è¯•è„šæœ¬ (stress_test.sh)

é¢„å®šä¹‰å¤šç§æµ‹è¯•åœºæ™¯çš„ä¾¿æ·è„šæœ¬ï¼Œé€‚åˆå¿«é€Ÿæ€§èƒ½è¯„ä¼°ã€‚

#### åŸºæœ¬ä½¿ç”¨

```bash
# åœ¨å‹åŠ›æµ‹è¯•ç›®å½•è¿è¡Œ
cd test/stress

# æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
./stress_test.sh --help

# è¿è¡Œæ‰€æœ‰é¢„å®šä¹‰åœºæ™¯
./stress_test.sh --scenarios

# è‡ªå®šä¹‰å•ä¸ªæµ‹è¯•
./stress_test.sh -c 100 -n 2000 -cmd SET

# å¸¦è¿›åº¦æ˜¾ç¤ºçš„æµ‹è¯•
./stress_test.sh -c 50 -t 30s -cmd GET --progress
```

#### ä»é¡¹ç›®æ ¹ç›®å½•è¿è¡Œ

```bash
# ä½¿ç”¨ä¾¿æ·è„šæœ¬ (æ¨è)
./run_stress_test.sh --scenarios
./run_stress_test.sh -c 40 -n 800 -cmd SADD -d 64
```

#### è„šæœ¬å‚æ•°

| å‚æ•° | æè¿° | ç¤ºä¾‹ |
|------|------|------|
| `-h, --host` | RedisæœåŠ¡å™¨ä¸»æœº | `-h localhost` |
| `-p, --port` | RedisæœåŠ¡å™¨ç«¯å£ | `-p 6380` |
| `-c, --connections` | å¹¶å‘è¿æ¥æ•° | `-c 50` |
| `-n, --requests` | æ¯è¿æ¥è¯·æ±‚æ•° | `-n 1000` |
| `-t, --time` | æµ‹è¯•æŒç»­æ—¶é—´ | `-t 30s` |
| `-cmd, --command` | æµ‹è¯•å‘½ä»¤ | `-cmd SADD` |
| `-d, --data-size` | æ•°æ®å¤§å° | `-d 128` |
| `--progress` | æ˜¾ç¤ºè¿›åº¦ | `--progress` |
| `--scenarios` | è¿è¡Œæ‰€æœ‰åœºæ™¯ | `--scenarios` |

## æµ‹è¯•åœºæ™¯è¯¦è§£

### é¢„å®šä¹‰æµ‹è¯•åœºæ™¯

ä¾¿æ·è„šæœ¬åŒ…å«8ä¸ªç²¾å¿ƒè®¾è®¡çš„æµ‹è¯•åœºæ™¯ï¼š

#### Scenario 1: Basic SET operations
- **ç›®æ ‡**: æµ‹è¯•åŸºæœ¬å†™å…¥æ€§èƒ½
- **é…ç½®**: 50è¿æ¥ï¼Œ1000è¯·æ±‚ï¼Œ64å­—èŠ‚æ•°æ®
- **ç”¨é€”**: è¯„ä¼°åŸºç¡€å†™å…¥èƒ½åŠ›

#### Scenario 2: GET operations  
- **ç›®æ ‡**: æµ‹è¯•åŸºæœ¬è¯»å–æ€§èƒ½
- **é…ç½®**: 30è¿æ¥ï¼Œ1500è¯·æ±‚ï¼Œ64å­—èŠ‚æ•°æ®
- **ç”¨é€”**: è¯„ä¼°åŸºç¡€è¯»å–èƒ½åŠ›

#### Scenario 3: PING test
- **ç›®æ ‡**: æµ‹è¯•ç½‘ç»œå»¶è¿Ÿå’Œè¿æ¥æ€§èƒ½
- **é…ç½®**: 100è¿æ¥ï¼Œ500è¯·æ±‚
- **ç”¨é€”**: è¯„ä¼°æœ€ä½å»¶è¿ŸåŸºå‡†

#### Scenario 4: Hash operations
- **ç›®æ ‡**: æµ‹è¯•å“ˆå¸Œæ•°æ®ç»“æ„æ€§èƒ½
- **é…ç½®**: 20è¿æ¥ï¼Œ800è¯·æ±‚ï¼Œ128å­—èŠ‚æ•°æ®
- **ç”¨é€”**: è¯„ä¼°å¤æ‚æ•°æ®ç»“æ„å¤„ç†èƒ½åŠ›

#### Scenario 5: List operations
- **ç›®æ ‡**: æµ‹è¯•åˆ—è¡¨æ•°æ®ç»“æ„æ€§èƒ½
- **é…ç½®**: 25è¿æ¥ï¼Œ600è¯·æ±‚ï¼Œ32å­—èŠ‚æ•°æ®
- **ç”¨é€”**: è¯„ä¼°é˜Ÿåˆ—æ“ä½œæ€§èƒ½

#### Scenario 6: Set ADD operations âœ¨ æ–°å¢
- **ç›®æ ‡**: æµ‹è¯•é›†åˆæ·»åŠ æ“ä½œæ€§èƒ½
- **é…ç½®**: 40è¿æ¥ï¼Œ800è¯·æ±‚ï¼Œ64å­—èŠ‚æ•°æ®
- **ç”¨é€”**: è¯„ä¼°é›†åˆå†™å…¥æ€§èƒ½

#### Scenario 7: Set MEMBERS operations âœ¨ æ–°å¢
- **ç›®æ ‡**: æµ‹è¯•é›†åˆæˆå‘˜æŸ¥è¯¢æ€§èƒ½
- **é…ç½®**: 30è¿æ¥ï¼Œ600è¯·æ±‚
- **ç”¨é€”**: è¯„ä¼°é›†åˆè¯»å–æ€§èƒ½

#### Scenario 8: Mixed Set operations âœ¨ æ–°å¢
- **ç›®æ ‡**: æµ‹è¯•æ··åˆé›†åˆæ“ä½œæ€§èƒ½
- **é…ç½®**: 20è¿æ¥ï¼Œ400 SADD + 400 SMEMBERS
- **ç”¨é€”**: è¯„ä¼°çœŸå®åœºæ™¯ä¸‹çš„é›†åˆæ€§èƒ½

### è‡ªå®šä¹‰æµ‹è¯•åœºæ™¯

#### é«˜å¹¶å‘æµ‹è¯•
```bash
# é«˜å¹¶å‘SETæµ‹è¯•
./stress_test.sh -c 200 -n 500 -cmd SET -d 64

# é«˜å¹¶å‘é›†åˆæµ‹è¯•
./stress_test.sh -c 100 -n 500 -cmd SADD -d 128
```

#### å¤§æ•°æ®æµ‹è¯•
```bash
# 1KBæ•°æ®æµ‹è¯•
./stress_test.sh -c 20 -n 200 -cmd SET -d 1024

# 4KBæ•°æ®æµ‹è¯•
./stress_test.sh -c 10 -n 100 -cmd SET -d 4096
```

#### é•¿æ—¶é—´å‹åŠ›æµ‹è¯•
```bash
# 5åˆ†é’ŸæŒç»­æµ‹è¯•
./stress_test.sh -c 50 -t 5m -cmd GET --progress

# é›†åˆæ“ä½œé•¿æ—¶é—´æµ‹è¯•
./stress_test.sh -c 30 -t 2m -cmd SMEMBERS --progress
```

## GoåŸºå‡†æµ‹è¯•

### è¿è¡ŒåŸºå‡†æµ‹è¯•

```bash
# è¿›å…¥å‹åŠ›æµ‹è¯•ç›®å½•
cd test/stress

# è¿è¡Œæ‰€æœ‰åŸºå‡†æµ‹è¯•
go test -bench=. -benchmem

# è¿è¡Œç‰¹å®šåŸºå‡†æµ‹è¯•
go test -bench=BenchmarkSET -benchmem

# é•¿æ—¶é—´åŸºå‡†æµ‹è¯•
go test -bench=. -benchtime=10s

# ä¸åŒCPUé…ç½®æµ‹è¯•
go test -bench=. -cpu=1,2,4

# è¯¦ç»†è¾“å‡º
go test -bench=. -benchmem -v
```

### å¯ç”¨çš„åŸºå‡†æµ‹è¯•

#### å•å‘½ä»¤åŸºå‡†æµ‹è¯•
- `BenchmarkSET` - SET å‘½ä»¤æ€§èƒ½æµ‹è¯•
- `BenchmarkGET` - GET å‘½ä»¤æ€§èƒ½æµ‹è¯•  
- `BenchmarkPING` - PING å‘½ä»¤æ€§èƒ½æµ‹è¯•
- `BenchmarkHSET` - HSET å‘½ä»¤æ€§èƒ½æµ‹è¯•
- `BenchmarkHGET` - HGET å‘½ä»¤æ€§èƒ½æµ‹è¯•
- `BenchmarkLPUSH` - LPUSH å‘½ä»¤æ€§èƒ½æµ‹è¯•
- `BenchmarkSADD` - SADD å‘½ä»¤æ€§èƒ½æµ‹è¯• âœ¨ æ–°å¢

#### å¤åˆåŸºå‡†æµ‹è¯•
- `BenchmarkMixed` - æ··åˆå‘½ä»¤æ€§èƒ½æµ‹è¯•
- `BenchmarkConcurrentConnections` - å¹¶å‘è¿æ¥æ€§èƒ½æµ‹è¯•

### åŸºå‡†æµ‹è¯•ç»“æœè§£é‡Š

```
BenchmarkSET-8    	   10000	    134567 ns/op	     128 B/op	       3 allocs/op
```

**ç»“æœè§£è¯»**:
- `BenchmarkSET-8`: åŸºå‡†æµ‹è¯•åç§°ï¼ˆ8è¡¨ç¤ºGOMAXPROCSï¼‰
- `10000`: è¿è¡Œæ¬¡æ•°
- `134567 ns/op`: æ¯æ¬¡æ“ä½œå¹³å‡è€—æ—¶ï¼ˆçº³ç§’ï¼‰
- `128 B/op`: æ¯æ¬¡æ“ä½œå¹³å‡å†…å­˜åˆ†é…
- `3 allocs/op`: æ¯æ¬¡æ“ä½œå¹³å‡å†…å­˜åˆ†é…æ¬¡æ•°

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

#### 1. è¿æ¥å¤±è´¥
```bash
# é—®é¢˜: Cannot connect to Redis server
# æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€
netstat -tlnp | grep 6380
ps aux | grep redigo

# è§£å†³æ–¹æ¡ˆ
cd /path/to/redigo
go run main.go
```

#### 2. æ€§èƒ½å¼‚å¸¸ä½

**è¯Šæ–­æ­¥éª¤**:
```bash
# æ£€æŸ¥ç³»ç»Ÿèµ„æº
top
free -h
iostat 1

# æ£€æŸ¥ç½‘ç»œçŠ¶æ€
netstat -i
ss -tuln
```

**å¸¸è§åŸå› **:
- ç³»ç»Ÿèµ„æºä¸è¶³
- ç½‘ç»œå»¶è¿Ÿé«˜
- RedisæœåŠ¡å™¨è¿‡è½½
- æ–‡ä»¶æè¿°ç¬¦é™åˆ¶

#### 3. é«˜é”™è¯¯ç‡

**æ£€æŸ¥å‘½ä»¤**:
```bash
# é™ä½å¹¶å‘æ•°é‡è¯•
go run main.go -c 10 -n 100 -cmd SET

# å¢åŠ è¶…æ—¶æ—¶é—´
go run main.go -c 50 -n 1000 -cmd SET -timeout 5s
```

#### 4. å†…å­˜ä¸è¶³
```bash
# æ£€æŸ¥å†…å­˜ä½¿ç”¨
free -h
cat /proc/meminfo

# å‡å°‘å¹¶å‘å’Œæ•°æ®å¤§å°
go run main.go -c 20 -n 500 -d 32 -cmd SET
```

### è°ƒè¯•æŠ€å·§

#### å¯ç”¨è¯¦ç»†æ—¥å¿—
```bash
# æ˜¾ç¤ºè¿›åº¦ä¿¡æ¯
go run main.go -c 50 -n 1000 --progress

# ä½¿ç”¨å°è§„æ¨¡æµ‹è¯•è°ƒè¯•
go run main.go -c 1 -n 10 -cmd SET
```

#### åˆ†æ­¥æµ‹è¯•
```bash
# 1. æµ‹è¯•è¿æ¥
go run main.go -c 1 -n 1 -cmd PING

# 2. æµ‹è¯•åŸºç¡€æ“ä½œ
go run main.go -c 5 -n 10 -cmd SET

# 3. é€æ­¥å¢åŠ è´Ÿè½½
go run main.go -c 10 -n 100 -cmd SET
go run main.go -c 50 -n 1000 -cmd SET
```

## æ‰©å±•åŠŸèƒ½

### è‡ªå®šä¹‰å‘½ä»¤æ”¯æŒ

å¦‚éœ€æ·»åŠ æ–°çš„Rediså‘½ä»¤æ”¯æŒï¼Œå¯ä»¥ä¿®æ”¹ `main.go`:

```go
case "CUSTOM":
    // æ·»åŠ è‡ªå®šä¹‰å‘½ä»¤
    return fmt.Sprintf("*2\r\n$6\r\nCUSTOM\r\n$%d\r\n%s\r\n", len(key), key)
```

### ç»“æœå¯¼å‡º

#### ä¿å­˜æµ‹è¯•ç»“æœ
```bash
# å¯¼å‡ºåˆ°æ–‡ä»¶
go run main.go -c 50 -n 1000 > test_results.txt

# å¸¦æ—¶é—´æˆ³çš„ç»“æœ
go run main.go -c 50 -n 1000 | tee results_$(date +%Y%m%d_%H%M%S).log
```

### è‡ªåŠ¨åŒ–æ‰¹é‡æµ‹è¯•

#### åˆ›å»ºæ‰¹é‡æµ‹è¯•è„šæœ¬
```bash
#!/bin/bash
# batch_test.sh

echo "å¼€å§‹æ‰¹é‡æ€§èƒ½æµ‹è¯•..."

# ä¸åŒå¹¶å‘æ•°æµ‹è¯•
for connections in 10 20 50 100; do
    echo "æµ‹è¯•å¹¶å‘æ•°: $connections"
    go run main.go -c $connections -n 1000 -cmd SET
    echo "---"
done

# ä¸åŒå‘½ä»¤æµ‹è¯•
for cmd in SET GET PING SADD SMEMBERS; do
    echo "æµ‹è¯•å‘½ä»¤: $cmd"
    go run main.go -c 50 -n 1000 -cmd $cmd
    echo "---"
done
```